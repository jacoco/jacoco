/*******************************************************************************
 * Copyright (c) 2009, 2025 Mountainminds GmbH & Co. KG and Contributors
 * This program and the accompanying materials are made available under
 * the terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0
 *
 * SPDX-License-Identifier: EPL-2.0
 *
 * Contributors:
 *    Marc R. Hoffmann - initial API and implementation
 *
 *******************************************************************************/
import java.io.*;
import org.codehaus.plexus.util.*;

// Check that HTML report was created
File htmlReportIndex = new File( basedir, "target/site/jacoco/org.project/index.html" );
if ( !htmlReportIndex.isFile() ) {
    throw new RuntimeException( "HTML report index was not created" );
}

// Check that main source file has a report page (should exist)
File mainClassReportFile = new File( basedir, "target/site/jacoco/org.project/MainClass.html" );
if ( !mainClassReportFile.isFile() ) {
    throw new RuntimeException( "MainClass.html (main source) was not created" );
}

// Check that test source file does NOT have a report page
File testReportFile = new File( basedir, "target/site/jacoco/org.project/MainClassTest.html" );
if ( testReportFile.isFile() ) {
    throw new RuntimeException( "MainClassTest.html (test source) should NOT be created" );
}

// Check that test helper file does NOT have a report page
File testUtilityReportFile = new File( basedir, "target/site/jacoco/org.project/TestUtility.html" );
if ( testUtilityReportFile.isFile() ) {
    throw new RuntimeException( "TestUtility.html (test source) should NOT be created" );
}

// Check that the index page contains reference to main class
String indexContent = FileUtils.fileRead( htmlReportIndex );
if ( indexContent.indexOf( "MainClass.html" ) < 0 ) {
    throw new RuntimeException( "Index does not contain reference to MainClass" );
}

// Check that index does NOT contain reference to test class
if ( indexContent.indexOf( "MainClassTest" ) >= 0 ) {
    throw new RuntimeException( "Index should NOT contain reference to MainClassTest class" );
}

// Check that index does NOT contain reference to test utility
if ( indexContent.indexOf( "TestUtility" ) >= 0 ) {
    throw new RuntimeException( "Index should NOT contain reference to TestUtility class" );
}

// Verify XML report
File xmlReportFile = new File( basedir, "target/site/jacoco/jacoco.xml" );
if ( !xmlReportFile.isFile() ) {
    throw new RuntimeException( "XML report was not created" );
}

// Check XML content contains main class
String xmlContent = FileUtils.fileRead( xmlReportFile );
if ( xmlContent.indexOf( "\"org/project/MainClass\"" ) < 0 ) {
    throw new RuntimeException( "XML report does not contain MainClass" );
}

// Check MainClassTest is NOT in the report
if ( xmlContent.indexOf( "\"org/project/MainClassTest\"" ) >= 0 ) {
    throw new RuntimeException( "XML report should NOT contain MainClassTest class" );
}

// Check XML does NOT contain test utility class
if ( xmlContent.indexOf( "\"org/project/TestUtility\"" ) >= 0 ) {
    throw new RuntimeException( "XML report should NOT contain TestUtility class" );
}
